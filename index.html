<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>เช็ค E-mail by Pony shop ร้านโพนี่ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; background:#0b0b0b; color:#e8e8e8; margin:24px; }
    .card { max-width:800px; margin:auto; padding:20px; border:1px solid #2a2a2a; border-radius:16px; background:#111; }
    h2 { margin-top:0; }
    input { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #2a2a2a; background:#0c0c0c; color:#e8e8e8; }
    button { padding:10px 14px; margin-top:10px; border:0; border-radius:10px; background:#4b7bec; color:#fff; font-weight:600; cursor:pointer; }
    .status { margin-top:10px; font-size:14px; }
    .list { margin-top:20px; display:grid; gap:12px; }
    .item { border:1px solid #2a2a2a; border-radius:12px; padding:12px; background:#0c0c0c; }
    .kv { display:grid; grid-template-columns: 100px 1fr; gap:6px 12px; }
    .k { color:#aaa; }
  </style>
</head>
<body>
  <div class="card">
    <h2>เช็ค E-mail </h2>

    <input id="email" type="email" placeholder="กรอกอีเมล" />
    <input id="password" type="password" placeholder="กรอกรหัสผ่าน" />
    <button id="fetchBtn">เช็คข้อความ</button>

    <div id="status" class="status"></div>
    <div id="list" class="list"></div>
  </div>

  <script>
    const fetchBtn = document.getElementById("fetchBtn");
    const statusEl = document.getElementById("status");
    const listEl = document.getElementById("list");

    function setStatus(msg, isErr=false) {
      statusEl.textContent = msg;
      statusEl.style.color = isErr ? "#ff6b6b" : "#9aa0a6";
    }

    function cleanText(s="") {
      return s.replace(/\\r|\\n/g, "").replace(/\\u0e49/g,"").trim();
    }

    function normalizeItem(it) {
      return {
        email: it.email || "",
        subject: it.subject || "",
        from: it.from || "",
        text: cleanText(it.text || ""),
        date: it.date || ""
      };
    }

    function renderList(items) {
      listEl.innerHTML = "";
      if (!items.length) { listEl.innerHTML = "<div>ไม่มีข้อมูล</div>"; return; }
      items.forEach(it => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="kv">
            <div class="k">email</div><div>${it.email}</div>
            <div class="k">subject</div><div>${it.subject}</div>
            <div class="k">from</div><div>${it.from}</div>
            <div class="k">text</div><div>${it.text}</div>
            <div class="k">date</div><div>${it.date}</div>
          </div>`;
        listEl.appendChild(div);
      });
    }

    fetchBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      if (!email || !password) { setStatus("กรอก email และ password ก่อน", true); return; }
      setStatus("กำลังดึงข้อมูล...");
      try {
        const resp = await fetch("https://unlimitmail.com/api/email/getEmailContentByEmail", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        const json = await resp.json();
        const arr = Array.isArray(json.data) ? json.data.map(normalizeItem) : [];
        renderList(arr);
        setStatus("สำเร็จ • " + arr.length + " รายการ");
      } catch (e) {
        setStatus("ผิดพลาด: " + e.message, true);
      }
    });
  </script>
</body>
</html>


